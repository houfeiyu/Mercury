/* 2017-12-12 13:02:29 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 */
var manageLayersWidget=L.widget.bindClass(L.widget.BaseWidget.extend({map:null,options:{view:{type:"window",url:"view.html",windowOptions:{width:200,height:500}}},hasManagerBaseMaps:!0,create:function(){},viewWindow:null,winCreateOK:function(e,a){this.viewWindow=a},activate:function(){},disable:function(){},_tempIdx:1,arrIdx:[],getNextId:function(){for(;this.arrIdx.indexOf(this._tempIdx)!=-1;)this._tempIdx++;return this.arrIdx.push(this._tempIdx),this._tempIdx},_layers:null,getLayers:function(){if(null==this._layers){var e=[],a=this.hasManagerBaseMaps?this.map.gisdata.config.basemaps:[],t=this.map.gisdata.config.operationallayers;this._tempIdx=1,this.arrIdx=[];for(var i=0;i<a.length;i++){var r=a[i];r.id&&this.arrIdx.push(r.id)}for(var i=0;i<t.length;i++){var r=t[i];r.id&&this.arrIdx.push(r.id)}for(var i=0;i<a.length;i++){var r=a[i];if(r.name||(r.name="未命名"),r.id||(r.id=this.getNextId()),r.pid||(r.pid=-1),e.push(r),"group"==r.type&&r.layers)for(var n=0;n<r.layers.length;n++){var s=r.layers[n];s.pid=r.id,s.id=this.getNextId(),s.name||(s.name=r.name+"-"+(n+1)),s._parent=r,e.push(s)}else{var d=this.getChildLayers(r._layer);if(d&&d.length>0)for(var n=0;n<d.length;n++){var o=d[n],s={pid:r.id,id:this.getNextId(),name:o.options.name,_layer:o};s.name||(s.name=r.name+"-"+(n+1)),s._parent=r,o.config=s,e.push(s)}}}for(var i=0;i<t.length;i++){var r=t[i];r.name||(r.name="未命名"),r.id||(r.id=this.getNextId()),r.pid||(r.pid=-1),e.push(r)}for(var i=0;i<e.length;i++){var r=e[i],h=Number(r.order);isNaN(h)&&(h=10*(i+1)),r.order=h,r._key=i+"_"+r.id+"_"+r.name,null!=r._layer&&this.udpateLayerZIndex(r._layer,h)}this._layers=e}return this._layers},getLayerVisible:function(e){return this.map.hasLayer(e)},getChildLayers:function(e){return e instanceof L.LayerGroup||e instanceof L.FeatureGroup?e.getLayers():null},addLayerManager:function(e,a){var t={pid:-1,id:this.getNextId(),name:e,_layer:a};a.config=t,this._layers.push(t)},removeLayerManager:function(e){for(var a=0;a<this._layers.length;a++){var t=this._layers[a];if(t._layer==e){this._layers.splice(a,1);break}}},updateLayerVisible:function(e,a,t){var i=this;t?a?(t.addLayer(e),t.eachLayer(function(e){i.udpateLayerZIndex(e,e.config.order)})):t.removeLayer(e):a?(this.map.addLayer(e),e.config&&e.config.order&&this.udpateLayerZIndex(e,e.config.order)):this.map.removeLayer(e)},udpateLayerOpacity:function(e,a){var t=this;e instanceof L.LayerGroup||e instanceof L.FeatureGroup?e.eachLayer(function(e){t.udpateLayerOpacity(e,a)}):(e.setOpacity&&e.setOpacity(a),e instanceof L.Path&&(e.options.opacity=a,e.setStyle(e.options)))},udpateLayerZIndex:function(e,a){e.setZIndex&&e.setZIndex(a)}}));